<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Like Hero To Zero</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/app.css}" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg mb-3">
    <div class="container">
        <a class="navbar-brand fw-bold text-white" href="/">Like Hero To Zero</a>
        <div class="ms-auto d-flex gap-2">
            <a class="btn btn-outline-light" href="/country">Mein Land</a>
            <a class="btn btn-outline-light" href="/emissions">Alle Daten</a>
            <a class="btn btn-outline-light" href="/login" sec:authorize="!isAuthenticated()">Login</a>
            <a class="btn btn-outline-light" href="/manage/emissions" sec:authorize="hasAnyRole('SCIENTIST','ADMIN')">Verwalten</a>
            <a class="btn btn-outline-light" href="/logout" sec:authorize="isAuthenticated()">Logout</a>
        </div>
    </div>
</nav>

<<div class="container mb-3">
    <form class="row g-2 justify-content-center" method="get" th:action="@{/emissions}">
        <div class="col-md-5 col-sm-12">
            <input class="form-control" type="text" name="q"
                   placeholder="Land suchen…" th:value="${q}">
        </div>
        <div class="col-md-2 col-sm-6">
            <input class="form-control" type="number" name="size"
                   min="5" max="100" th:value="${size}">
        </div>
        <div class="col-md-2 col-sm-6 d-grid">
            <button class="btn btn-brand" type="submit">Filtern</button>
        </div>
    </form>
</div>
<div class="container">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h2 class="mb-0" style="color:#2e7d32;">CO₂-Emissionsdaten</h2>
        <a class="btn btn-brand" href="/">Zurück</a>
    </div>

    <div class="card p-3">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                <tr>
                    <th>Land</th>
                    <th>Jahr</th>
                    <th>CO₂ (kt)</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="e : ${emissions}">
                    <td th:text="${e.country}">Germany</td>
                    <td th:text="${e.year}">2023</td>
                    <td th:text="${e.emissionsKt}">620000</td>
                </tr>
                <tr th:if="${#lists.isEmpty(emissions)}">
                    <td colspan="3" class="text-muted">Noch keine Daten vorhanden.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- hübsche Pagination unter der Tabelle -->
    <div class="pager-bar" th:if="${page != null and page.totalPages > 1}"
         th:with="total=${page.totalPages}, current=${page.number},
              start=${current > 2 ? current - 2 : 0},
              end=${current + 2 < total - 1 ? current + 2 : total - 1}">
        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-2">
            <div class="pager-info">
                Seite <span th:text="${current + 1}">1</span> von <span th:text="${total}">5</span> ·
                Einträge pro Seite: <span th:text="${page.size}">20</span> ·
                Gesamt: <span th:text="${page.totalElements}">0</span>
            </div>
            <nav aria-label="Seiten-Navigation">
                <ul class="pagination mb-0">
                    <!-- Prev -->
                    <li class="page-item" th:classappend="${page.first} ? 'disabled'">
                        <a class="page-link" th:href="@{|/emissions?page=${current-1}&size=${page.size}|}" aria-label="Vorherige">«</a>
                    </li>

                    <!-- 1 -->
                    <li class="page-item" th:classappend="${current==0} ? 'active'">
                        <a class="page-link" th:href="@{|/emissions?page=0&size=${page.size}|}">1</a>
                    </li>

                    <!-- … links -->
                    <li class="page-item disabled" th:if="${start > 1}">
                        <span class="page-link">…</span>
                    </li>

                    <!-- Mittelbereich -->
                    <li class="page-item"
                        th:each="i : ${#numbers.sequence(start > 1 ? start : 1, end)}"
                        th:classappend="${i==current} ? 'active'">
                        <a class="page-link" th:text="${i + 1}"
                           th:href="@{|/emissions?page=${i}&size=${page.size}|}">2</a>
                    </li>

                    <!-- … rechts -->
                    <li class="page-item disabled" th:if="${end < total - 2}">
                        <span class="page-link">…</span>
                    </li>

                    <!-- letzte -->
                    <li class="page-item" th:if="${total > 1}" th:classappend="${current==total-1} ? 'active'">
                        <a class="page-link" th:text="${total}"
                           th:href="@{|/emissions?page=${total-1}&size=${page.size}|}">99</a>
                    </li>

                    <!-- Next -->
                    <li class="page-item" th:classappend="${page.last} ? 'disabled'">
                        <a class="page-link" th:href="@{|/emissions?page=${current+1}&size=${page.size}|}" aria-label="Nächste">»</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

</div>

<footer class="footer text-center">
    <div class="container">
        <div>© <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2025</span> Like Hero To Zero</div>
    </div>
</footer>
</body>
</html>
