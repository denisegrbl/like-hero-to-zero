<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Like Hero To Zero</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/app.css}" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg mb-3">
    <div class="container">
        <a class="navbar-brand fw-bold text-white" href="/">Like Hero To Zero</a>
        <div class="ms-auto d-flex gap-2">
            <a class="btn btn-outline-light" href="/country">Mein Land</a>
            <a class="btn btn-outline-light" href="/emissions">Alle Daten</a>
            <a class="btn btn-outline-light" href="/login" sec:authorize="!isAuthenticated()">Login</a>
            <!-- Scientist sieht 'Verwalten' -->
            <a class="btn btn-outline-light" href="/manage/emissions" sec:authorize="hasRole('SCIENTIST')">
                Verwalten
            </a>

            <!-- Admin sieht 'Moderation' -->
            <a class="btn btn-outline-light" href="/admin/moderation" sec:authorize="hasRole('ADMIN')">
                Moderation
            </a>
            <a class="btn btn-outline-light" href="/logout" sec:authorize="isAuthenticated()">Logout</a>
        </div>
    </div>
</nav>


<div class="container">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h2 class="mb-0" style="color:#2e7d32;">CO₂-Emissionsdaten</h2>
        <a class="btn btn-brand" href="/">Zurück</a>
    </div>

<div class="container">
    <div class="card p-3 mb-4">
        <form class="row g-2" method="get" action="/country">
            <div class="col-sm-8">
                <label class="form-label">Land auswählen</label>
                <select class="form-select" name="name" required>
                    <option th:each="c : ${countries}"
                            th:value="${c}"
                            th:text="${c}"
                            th:selected="${selected} == ${c}">
                    </option>
                </select>
            </div>
            <div class="col-sm-4 d-flex align-items-end">
                <button class="btn btn-brand w-100" type="submit">Aktuellsten Wert anzeigen</button>
            </div>
        </form>
    </div>

    <div th:if="${latest != null}">
        <div class="card p-4 mb-4">
            <h3 class="mb-3" style="color:#2e7d32;" th:text="${selected}">Deutschland</h3>
            <p class="lead mb-0">
                Neuester CO₂-Wert:
                <b th:text="${#numbers.formatDecimal(latest.emissionsKt, 0, 'COMMA', 0, 'POINT')}">620000</b> kt
                (<span th:text="${latest.year}">2023</span>)
            </p>
        </div>

        <div class="card p-3">
            <h5 class="mb-3">Verlauf (letzte 10 Einträge)</h5>
            <div class="table-responsive">
                <table class="table table-sm align-middle">
                    <thead>
                    <tr><th>Jahr</th><th>CO₂ (kt)</th></tr>
                    </thead>
                    <tbody>
                    <tr th:each="e : ${recent}">
                        <td th:text="${e.year}">2023</td>
                        <td th:text="${#numbers.formatDecimal(e.emissionsKt, 0, 'COMMA', 0, 'POINT')}">620000</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div th:if="${latest == null}" class="alert alert-warning">
        Kein Eintrag für das gewählte Land vorhanden.
    </div>
</div>

<footer class="footer text-center">
    <div class="container">
        <div>© <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2025</span> Like Hero To Zero</div>
    </div>
</footer>
</div>
</body>
</html>
